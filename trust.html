<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lecture & Lab Grade Calculator for Programming 2</title>
  <!-- MathJax for LaTeX rendering -->
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <!-- Confetti Library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    /* GLOBAL RESET & BASE STYLING */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(to bottom, #000000 0%, #1c7019 100%) no-repeat;
      color: #000000;
      line-height: 1.5;
      padding: 20px;
      background-image: url('bg.jpg');
      background-size: cover;
    }
    /* Notification styling */
    #globalNotification {
      display: none;
      text-align: center;
      font-size: 1.5rem;
      color: #ffffff;
      background-color: #337730;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 10px;
    }
    /* Global buttons container */
    #globalActions {
      text-align: center;
      margin-bottom: 20px;
    }
    #globalActions button {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      box-shadow: 5px 5px 10px #d9d9d9, -5px -5px 10px #ffffff;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      margin: 5px;
    }
    #globalActions button:hover {
      transform: translateY(-2px);
      box-shadow: 8px 8px 15px #d9d9d9, -8px -8px 15px #ffffff;
    }
    /* The rest of your styles ... */
    .body-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .description-sidebar {
      background: #dabb58;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      height: fit-content;
      width: 70%;
      margin: auto;
    }
    .sidebar-image {
      width: 70%;
      height: auto;
      margin: auto;
      border: 2px solid #ddd;
      border-radius: 8px;
      display: none;
    }
    .sidebar-image-container {
      overflow: visible;
      height: auto;
    }
    .sidebar-image.active {
      display: block;
    }
    /* Instructions */
    .instructions {
      margin-bottom: 20px;
    }
    .instructions h3 {
      color: #000000;
      margin-bottom: 10px;
      font-size: 1.2rem;
    }
    .instructions ul {
      padding-left: 20px;
      margin-bottom: 15px;
    }
    .instructions li {
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    @media (max-width: 768px) {
      .body-container {
        grid-template-columns: 1fr;
      }
      .description-sidebar {
        order: -1;
        margin-bottom: 30px;
      }
    }
    /* TAB BUTTONS */
    .tab-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
    }
    .tab-buttons button {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      box-shadow: 5px 5px 10px #d9d9d9, -5px -5px 10px #ffffff;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .tab-buttons button.active-tab {
      background: gold;
      color: rgb(61, 146, 12);
      box-shadow: 5px 5px 10px #1f4a6d33, -5px -5px 10px #ffffff80;
    }
    .tab-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 8px 8px 15px #d9d9d9, -8px -8px 15px #ffffff;
    }
    /* TAB CONTENT */
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* CONTAINER */
    .container {
      max-width: 650px;
      margin: auto;
      padding: 20px;
      background: linear-gradient(to bottom, hsl(110, 59%, 82%) 0%, #b6ffa0 100%);
      border: 1px solid #ffc711;
      border-radius: 6px;
      margin-bottom: 30px;
    }
    .container h2 {
      margin-bottom: 15px;
      font-size: 1.5rem;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
      text-align: center;
    }
    /* INPUT GROUPS */
    .input-group {
      margin-bottom: 15px;
    }
    .input-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
    }
    .perfect-btn {
      margin-left: 10px;
      padding: 6px 12px;
      background-color: rgb(187, 131, 131);
      color: rgb(10, 6, 6);
      border-radius: 6px;
      cursor: pointer;
    }
    .perfect-btn:hover {
      background-color: #56b852;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border-color 0.2s;
    }
    input[type="number"]:focus {
      border-color: #007bff;
      outline: none;
    }
    /* BUTTONS */
    .random-btn, .calculate-btn, .fard-btn {
      display: block;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      margin-bottom: 10px;
      transition: background-color 0.2s;
    }
    .random-btn {
      background-color: #6f42c1;
      color: #fff;
    }
    .random-btn:hover {
      background-color: #5a359b;
    }
    .calculate-btn {
      background-color: #28a745;
      color: white;
    }
    .calculate-btn:hover {
      background-color: #218838;
    }
    .fard-btn {
      background-color: #f19100;
      color: white;
    }
    .fard-btn:hover {
      background-color: #a37000;
    }
    /* FILE UPLOAD */
    .file-upload {
      display: block;
      margin: 10px auto;
    }
    /* ERROR MESSAGES */
    #error-lecture, #error-lab {
      color: #dd0700;
      font-weight: 500;
      margin-top: 10px;
      text-align: center;
    }
    #error-lecture ul, #error-lab ul {
      margin: 0;
      padding-left: 20px;
    }
    /* TOGGLE CHECKBOX */
    .toggle-container {
      margin: 15px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .toggle-container label {
      cursor: pointer;
      user-select: none;
      margin-left: 8px;
      font-weight: 500;
    }
    /* STEP-BY-STEP BOX */
    .steps {
      margin-top: 20px;
      border: 1px solid #eee;
      border-radius: 4px;
      padding: 15px;
      display: none;
      background-color: #fafafa;
      word-wrap: break-word;
      white-space: pre-wrap;
      overflow-x: auto;
    }
    .step {
      margin: 10px 0;
      opacity: 0;
      transition: opacity 0.5s;
    }
    .step.visible {
      opacity: 1;
    }
    .final-grade {
      font-weight: 600;
      margin-top: 10px;
    }
    .rounded-info {
      margin-top: 6px;
      font-style: italic;
      color: #ffffff;
    }
    /* PASS/FAIL STAMP */
    .stamp {
      display: inline-block;
      padding: 0.45em 1em;
      font-weight: bold;
      border: 4px solid;
      border-radius: 5px;
      text-transform: uppercase;
      margin-left: 15px;
      transform: rotate(-15deg);
      animation: stampIn 0.5s ease forwards;
      opacity: 0;
      font-size: 0.9rem;
    }
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 20px;
      }
      h2 {
        font-size: 1.5rem;
      }
      .sidebar-image {
        width: 100%;
      }
    }
    .stamp.passed {
      color: #28a745;
      border-color: #28a745;
    }
    .stamp.failed {
      color: #dc3545;
      border-color: #dc3545;
    }
    @keyframes stampIn {
      0% {
        transform: scale(2) rotate(-45deg);
        opacity: 0;
      }
      100% {
        transform: scale(1) rotate(-15deg);
        opacity: 1;
      }
    }
    .custom-upload-btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: #295829;
      color: #1df700;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    .custom-upload-btn:hover {
      background-color: #d67403;
    }
    .upload-status {
      margin-left: 10px;
      font-size: 1rem;
      vertical-align: middle;
    }
    .upload-status .checkmark {
      color: green;
      font-weight: bold;
    }
    .upload-status .error {
      color: red;
      font-weight: bold;
    }
    h1 {
      text-align: center;
      margin: auto;
      color: rgba(241, 255, 248, 0.836);
      padding: 10px 20px;
      background-color: #337730;
      border-radius: 55px;
    }
    .reset-btn {
      display: inline-block;
      padding: 10px 20px;
      background-color: #295829;
      color: #1df700;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    .reset-btn:hover {
      background-color: #d67403;

    }
    .ace-btn {
      padding: 10px 20px;
      background-color: #f1d326;
      color: #ee0000;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
      margin: auto;
    }
    .ace-btn:hover {
      background-color: #d67403;

    }
  </style>
</head>
<body>
  <h1>üòãProgramming 2 Prelim Grade Calculator 2025üòã</h1>
  <!-- Global Notification and Reset -->
  <div id="globalNotification">calculate time!ü§ë</div>
  <div id="globalActions">
    
  </div>
  <!-- TAB BUTTONS -->
  <div class="tab-buttons">
    <button id="tabLecture" class="active-tab" onclick="showTab('lecture')">Lecture Calculator</button>
    <button id="tabLab" onclick="showTab('lab')">Lab Calculator</button>
  </div>
  <!-- LECTURE TAB -->
  <div id="lecture" class="tab-content active">
    <div class="container">
      <h2>Lecture Grade Calculator</h2>
      <p>You can upload CSV file by clicking here:</p>
      <!-- Lecture CSV Upload -->
      <input type="file" id="csvUploadLecture" class="file-upload" accept=".csv" onchange="uploadCSVLecture(event)" style="display: none;" onclick="document.getElementById('lecture-upload-status').innerHTML='';">
      <label for="csvUploadLecture" class="custom-upload-btn">üîº Upload CSV</label>
      <span id="lecture-upload-status" class="upload-status"></span>
      <div class="csv-section">
        <hr><br>
      </div>
      <!-- Random Valid Grades (Lecture) -->
      <button type="button" class="random-btn" onclick="setRandomValidLecture()">üé≤ Random Grade Generator Button</button>
      <br><br>
      <!-- Inputs -->
      <h3>Exam</h3>
      <div class="input-group">
        <label for="lec-exam">
          Exam Score (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lec-exam', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lec-exam" placeholder="Enter exam score" />
      </div>
      <br>
      <h3>Quizzes</h3>
      <div class="input-group">
        <label for="lec-essay">
          Essay Score (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lec-essay', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lec-essay" placeholder="Enter essay score" />
      </div>
      <div class="input-group">
        <label for="lec-pvm">
          PVM Score (0 - 60)
          <button type="button" class="perfect-btn" onclick="setPerfect('lec-pvm', 60)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lec-pvm" placeholder="Enter PVM score" />
      </div>
      <div class="input-group">
        <label for="lec-java">
          Java Score (0 - 40)
          <button type="button" class="perfect-btn" onclick="setPerfect('lec-java', 40)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lec-java" placeholder="Enter Java score" />
      </div>
      <div class="input-group">
        <label for="lec-js">
          JavaScript Score (0 - 40)
          <button type="button" class="perfect-btn" onclick="setPerfect('lec-js', 40)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lec-js" placeholder="Enter JavaScript score" />
      </div>
      <div class="input-group">
        <label>
          <h3>Attendance</h3>
          Please mark the dates attended:
        </label>
        <div>
          <input type="checkbox" id="lec-attendance-jan27" checked> 
          <label for="lec-attendance-jan27">Jan 27</label>
          <input type="checkbox" id="lec-attendance-feb03" checked> 
          <label for="lec-attendance-feb03">Feb 3</label>
          <input type="checkbox" id="lec-attendance-feb10" checked> 
          <label for="lec-attendance-feb10">Feb 10</label>
          <input type="checkbox" id="lec-attendance-feb17" checked> 
          <label for="lec-attendance-feb17">Feb 17</label>
        </div>
      </div>
      <!-- Toggle Step-by-Step -->
      <div class="toggle-container">
        <input type="checkbox" id="showStepsLecture" checked />
        <label for="showStepsLecture">Show Step-by-Step Calculation</label>
      </div>
      <button class="ace-btn" onclick="perfectLectureGrade()">üåü I aced this course!</button>
      <br>
      <br>
      <button class="calculate-btn" onclick="calculateLectureGrade()">Calculate Lecture Grade</button>
      <button onclick="resetGrades()" class="reset-btn">üîÅ Reset Grades</button>
      <button class="fard-btn" onclick="downloadLectureCSV()">üîΩ Download Grade as CSV</button>
      <div id="error-lecture"></div>
      <!-- Steps (Lecture) will be rendered in LaTeX -->
      <div id="steps-lecture" class="steps"></div>
    </div>
  </div>
  <!-- LAB TAB -->
  <div id="lab" class="tab-content">
    <div class="container">
      <h2>Lab Grade Calculator</h2>
      <p>You can upload CSV file by clicking here:</p>
      <!-- Lab CSV Upload -->
      <input type="file" id="csvUploadLab" class="file-upload" accept=".csv" onchange="uploadCSVLab(event)" style="display: none;" onclick="document.getElementById('lab-upload-status').innerHTML='';">
      <label for="csvUploadLab" class="custom-upload-btn">Upload CSV</label>
      <span id="lab-upload-status" class="upload-status"></span>
      <div class="csv-section">
        <hr><br>
      </div>
      <!-- Random Valid Grades (Lab) -->
      <button type="button" class="random-btn" onclick="setRandomValidLab()">üé≤ Random Grade Generator Button</button>
      <br><br>
      <!-- Inputs -->
      <div class="input-group">
        <label for="lab-java1">
          <h3>Exams</h3>
          Java 1 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-java1', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-java1" placeholder="Enter Java 1 score" />
      </div>
      <div class="input-group">
        <label for="lab-java2">
          Java 2 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-java2', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-java2" placeholder="Enter Java 2 score" />
      </div>
      <div class="input-group">
        <label for="lab-js1">
          JavaScript 1 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-js1', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-js1" placeholder="Enter JS 1 score" />
      </div>
      <div class="input-group">
        <label for="lab-js2">
          JavaScript 2 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-js2', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-js2" placeholder="Enter JS 2 score" />
      </div>
      <br>
      <h3>Lab Works</h3>
      <div class="input-group">
        <label for="lab-mp1">
          MP1 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-mp1', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-mp1" placeholder="Enter MP1 score" />
      </div>
      <div class="input-group">
        <label for="lab-mp2">
          MP2 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-mp2', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-mp2" placeholder="Enter MP2 score" />
      </div>
      <div class="input-group">
        <label for="lab-mp3">
          MP3 (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-mp3', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-mp3" placeholder="Enter MP3 score" />
      </div>
      <div class="input-group">
        <label for="lab-mp3d">
          MP3 (Documentation) (0 - 100)
          <button type="button" class="perfect-btn" onclick="setPerfect('lab-mp3d', 100)">Perfect Score Button!</button>
        </label>
        <input type="number" id="lab-mp3d" placeholder="Enter MP3 (Docu) score" />
      </div>
      <br>
      <div class="input-group">
        <label>
          <h3>Attendance</h3>
          Please mark the dates attended:
        </label>
        <div>
          <input type="checkbox" id="lab-attendance-jan27" checked> 
          <label for="lab-attendance-jan27">Jan 27</label>
          <input type="checkbox" id="lab-attendance-feb03" checked> 
          <label for="lab-attendance-feb03">Feb 3</label>
          <input type="checkbox" id="lab-attendance-feb10" checked> 
          <label for="lab-attendance-feb10">Feb 10</label>
          <input type="checkbox" id="lab-attendance-feb17" checked> 
          <label for="lab-attendance-feb17">Feb 17</label>
        </div>
      </div>
      <!-- Toggle Step-by-Step -->
      <div class="toggle-container">
        <input type="checkbox" id="showStepsLab" checked />
        <label for="showStepsLab">Show Step-by-Step Calculation</label>
      </div><button class="ace-btn" onclick="perfectLabGrade()">üåü I aced this course!</button>
      <br>
      <br>
      <button class="calculate-btn" onclick="calculateLabGrade()">üßÆ Calculate Lab Grade</button>
      <button onclick="resetGrades()" class="reset-btn">üîÅ Reset Grades</button>
      <div id="error-lab"></div>
      <button class="fard-btn" onclick="downloadLabCSV()">üîΩ Download Grade as CSV</button>
      <!-- Steps (Lab) will be rendered in LaTeX -->
      <div id="steps-lab" class="steps"></div>
    </div>
  </div>
  <script>
    // Global interval variables to prevent spamming outputs
    let currentLectureInterval = null;
    let currentLabInterval = null;

    /***********************************************************
     *                   TAB NAVIGATION
     ***********************************************************/
    function showTab(tabName) {
      // Switch active tabs
      document.getElementById('tabLecture').classList.remove('active-tab');
      document.getElementById('tabLab').classList.remove('active-tab');
      document.getElementById('lecture').classList.remove('active');
      document.getElementById('lab').classList.remove('active');
      
      if (tabName === 'lecture') {
        document.getElementById('lecture').classList.add('active');
        document.getElementById('tabLecture').classList.add('active-tab');
      } else {
        document.getElementById('lab').classList.add('active');
        document.getElementById('tabLab').classList.add('active-tab');
      }
      
      // Handle sidebar content
      const lectureImage = document.getElementById('lecture-image');
      const labImage = document.getElementById('lab-image');
      const lectureDesc = document.getElementById('lecture-desc');
      const labDesc = document.getElementById('lab-desc');
      
      // Reset all sidebar elements
      lectureImage.classList.remove('active');
      labImage.classList.remove('active');
      lectureDesc.style.display = 'none';
      labDesc.style.display = 'none';
      
      // Activate correct sidebar elements
      if (tabName === 'lecture') {
        lectureImage.classList.add('active');
        lectureDesc.style.display = 'block';
      } else {
        labImage.classList.add('active');
        labDesc.style.display = 'block';
      }
    }

    /***********************************************************
     *                   HELPER FUNCTIONS
     ***********************************************************/
    function setPerfect(fieldId, value) {
      const el = document.getElementById(fieldId);
      el.value = value;
      el.style.border = '';
    }
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function setValue(id, val) {
      const el = document.getElementById(id);
      el.value = val;
      el.style.border = '';
    }
    function createStamp(finalScore) {
      const stamp = document.createElement('div');
      stamp.classList.add('stamp');
      if (finalScore >= 75) {
        stamp.classList.add('passed');
        stamp.textContent = 'PASSED';
      } else {
        stamp.classList.add('failed');
        stamp.textContent = 'FAIL';
      }
      return stamp;
    }
    
    function showNotification() {
      const notification = document.getElementById('globalNotification');
      notification.style.display = 'block';
      confetti();
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    /***********************************************************
     *         ENHANCED CSV HANDLING WITH AUTOMATIC CALCULATION
     ***********************************************************/
    function handleCSV(file, type) {
      // Determine the status element based on type
      const statusElem = document.getElementById(type === 'lecture' ? "lecture-upload-status" : "lab-upload-status");
      
      // Check file extension
      if (!file.name.toLowerCase().endsWith('.csv')) {
        statusElem.innerHTML = `<span class="error">‚úñ Invalid file format. Please select a CSV file.</span>`;
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const text = e.target.result;
        const lines = text.split(/\r?\n/).filter(line => line.trim() !== '');
        
        if (lines.length < 2) {
          statusElem.innerHTML = `<span class="error">‚úñ CSV must have at least 1 data row.</span>`;
          return;
        }
        
        // Split header line and data line
        const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
        const data = lines[1].split(',').map(d => d.trim());
        
        // Expected headers per type
        let expectedHeaders = [];
        if (type === 'lecture') {
          expectedHeaders = ['exam', 'essay', 'pvm', 'java', 'js'];
        } else {
          expectedHeaders = ['java1', 'java2', 'js1', 'js2', 'mp1', 'mp2', 'mp3', 'mp3d'];
        }
        
        // Check if all expected headers are present
        const missing = expectedHeaders.filter(h => !headers.includes(h));
        if (missing.length > 0) {
          statusElem.innerHTML = `<span class="error">‚úñ Missing header(s): ${missing.join(", ")}</span>`;
          return;
        }
        
        // If everything is valid, update the status element with a check mark and the file name.
        statusElem.innerHTML = `<span class="checkmark">‚úî</span> ${file.name}`;
        
        // Mapping for populating input fields
        if (type === 'lecture') {
          const mapping = {
            'exam': 'lec-exam',
            'essay': 'lec-essay',
            'pvm': 'lec-pvm',
            'java': 'lec-java',
            'js': 'lec-js'
          };
          
          headers.forEach((header, i) => {
            if (mapping[header] && data[i]) {
              document.getElementById(mapping[header]).value = data[i];
            }
          });
          calculateLectureGrade();
        } else {
          const mapping = {
            'java1': 'lab-java1',
            'java2': 'lab-java2',
            'js1': 'lab-js1',
            'js2': 'lab-js2',
            'mp1': 'lab-mp1',
            'mp2': 'lab-mp2',
            'mp3': 'lab-mp3',
            'mp3d': 'lab-mp3d'
          };
          
          headers.forEach((header, i) => {
            if (mapping[header] && data[i]) {
              document.getElementById(mapping[header]).value = data[i];
            }
          });
          calculateLabGrade();
        }
      };
      reader.readAsText(file);
    }
    function uploadCSVLecture(event) {
      const file = event.target.files[0];
      if (file) {
        handleCSV(file, 'lecture');
        event.target.value = "";
      }
    }
    function uploadCSVLab(event) {
      const file = event.target.files[0];
      if (file) {
        handleCSV(file, 'lab');
        event.target.value = "";
      }
    }

    /***********************************************************
     *            LECTURE GRADE CALCULATOR
     ***********************************************************/
    function validateLecture() {
      const fields = [
        { id: 'lec-exam', label: 'Exam Score', min: 0, max: 100 },
        { id: 'lec-essay', label: 'Essay Score', min: 0, max: 100 },
        { id: 'lec-pvm', label: 'PVM Score', min: 0, max: 60 },
        { id: 'lec-java', label: 'Java Score', min: 0, max: 40 },
        { id: 'lec-js', label: 'JavaScript Score', min: 0, max: 40 }
      ];
      let errors = [];
      fields.forEach(f => {
        const el = document.getElementById(f.id);
        const rawValue = el.value.trim();
        const val = parseFloat(rawValue);
        el.style.border = '';
        if (!rawValue) {
          errors.push(`${f.label} is empty.`);
          el.style.border = '2px solid red';
        } else if (isNaN(val)) {
          errors.push(`${f.label} is not a valid number.`);
          el.style.border = '2px solid red';
        } else if (val < f.min || val > f.max) {
          errors.push(`${f.label} should be between ${f.min} and ${f.max}.`);
          el.style.border = '2px solid red';
        }
      });
      return errors;
    }
    function setRandomValidLecture() {
      document.getElementById('error-lecture').innerHTML = '';
      setValue('lec-exam', getRandomInt(0, 100));
      setValue('lec-essay', getRandomInt(0, 100));
      setValue('lec-pvm', getRandomInt(0, 60));
      setValue('lec-java', getRandomInt(0, 40));
      setValue('lec-js', getRandomInt(0, 40));
      const lecCheckboxes = [
        "lec-attendance-jan27",
        "lec-attendance-feb03",
        "lec-attendance-feb10",
        "lec-attendance-feb17"
      ];
      let absencesCount = getRandomInt(0, 3);
      let shuffled = lecCheckboxes.sort(() => 0.5 - Math.random());
      shuffled.forEach((id, index) => {
        document.getElementById(id).checked = (index < absencesCount ? false : true);
      });
    }
    function calculateLectureGrade() {
      // Clear any existing interval to avoid multiple outputs
      if (currentLectureInterval !== null) {
        clearInterval(currentLectureInterval);
        currentLectureInterval = null;
      }
      document.getElementById('error-lecture').innerHTML = '';
      const stepContainer = document.getElementById('steps-lecture');
      stepContainer.style.display = 'none';
      stepContainer.innerHTML = '';
      
      const errors = validateLecture();
      if (errors.length > 0) {
        let errHTML = '<ul>';
        errors.forEach(err => { errHTML += `<li>${err}</li>`; });
        errHTML += '</ul>';
        document.getElementById('error-lecture').innerHTML = errHTML;
        return;
      }
      
      // Show notification and confetti
      showNotification();
      
      const exam = parseFloat(document.getElementById('lec-exam').value);
      const essay = parseFloat(document.getElementById('lec-essay').value);
      const pvm = parseFloat(document.getElementById('lec-pvm').value);
      const java = parseFloat(document.getElementById('lec-java').value);
      const js = parseFloat(document.getElementById('lec-js').value);
      const lecAttendanceCheckboxes = [
        "lec-attendance-jan27",
        "lec-attendance-feb03",
        "lec-attendance-feb10",
        "lec-attendance-feb17"
      ];
      const absences = lecAttendanceCheckboxes.reduce((acc, id) => {
        return acc + (document.getElementById(id).checked ? 0 : 1);
      }, 0);
      if (absences >= 4) {
        const failStamp = createStamp(0);
        document.getElementById('error-lecture').innerHTML = '<ul><li>FAIL: Absences are 4 or more.</li></ul>';
        document.getElementById('error-lecture').appendChild(failStamp);
        return;
      }
      const essayPercent = (essay / 100) * 100;
      const pvmPercent = (pvm / 60) * 100;
      const javaPercent = (java / 40) * 100;
      const jsPercent = (js / 40) * 100;
      const sumOfQuizzes = essayPercent + pvmPercent + javaPercent + jsPercent;
      const prelimQuizzes = sumOfQuizzes / 4;
      const attendance = Math.max(100 - (absences * 10), 0);
      const prelimClassStanding = (prelimQuizzes * 0.60) + (attendance * 0.40);
      const prelimGrade = (exam * 0.60) + (prelimClassStanding * 0.40);
      const showSteps = document.getElementById('showStepsLecture').checked;
      if (!showSteps) {
        let resultMsg = `Your Final Lecture Grade: ${prelimGrade.toFixed(1)}`;
        if (!Number.isInteger(prelimGrade)) {
          const roundUp = Math.ceil(prelimGrade);
          const roundDown = Math.floor(prelimGrade);
          resultMsg += `<br>Rounded Up Standard: ${roundUp} | Rounded Down Standard: ${roundDown}`;
        }
        document.getElementById('error-lecture').innerHTML = resultMsg;
        document.getElementById('error-lecture').appendChild(createStamp(prelimGrade));
        return;
      }
      const steps = [
        `\\( \\text{Essay: } \\frac{${essay}}{100} \\times 100 = ${essayPercent.toFixed(2)}\\% \\)`,
        `\\( \\text{PVM: } \\frac{${pvm}}{60} \\times 100 = ${pvmPercent.toFixed(2)}\\% \\)`,
        `\\( \\text{Java: } \\frac{${java}}{40} \\times 100 = ${javaPercent.toFixed(2)}\\% \\)`,
        `\\( \\text{JS: } \\frac{${js}}{40} \\times 100 = ${jsPercent.toFixed(2)}\\% \\)`,
        `\\( \\text{Average Quizzes: } \\frac{${essayPercent.toFixed(2)}(essay) + ${pvmPercent.toFixed(2)}(PVM) + ${javaPercent.toFixed(2)}(Java) + ${jsPercent.toFixed(2)}(JS)}{4} = ${prelimQuizzes.toFixed(2)}\\% \\)`,
        `\\( \\text{Attendance: } 100 - (${absences} \\times 10) = ${attendance.toFixed(2)}\\% \\)`,
        `\\( \\text{Prelim Class Standing: } (${prelimQuizzes.toFixed(2)}\\% \\times 0.60)Quizzes + (${attendance.toFixed(2)}\\% \\times 0.40)Attendance = ${prelimClassStanding.toFixed(2)}\\% \\)`,
        `\\( \\text{Final Grade: } (${exam} \\times 0.60)Exam + (${prelimClassStanding.toFixed(2)}\\% \\times 0.40)ClassStanding = ${prelimGrade.toFixed(2)} \\)`
      ];
      stepContainer.style.display = 'block';
      let currentStep = 0;
      currentLectureInterval = setInterval(() => {
        if (currentStep < steps.length) {
          const stepEl = document.createElement('div');
          stepEl.classList.add('step', 'visible');
          stepEl.innerHTML = steps[currentStep];
          stepContainer.appendChild(stepEl);
          MathJax.typesetPromise([stepEl]);
          currentStep++;
        } else {
          clearInterval(currentLectureInterval);
          currentLectureInterval = null;
          const finalEl = document.createElement('div');
          finalEl.classList.add('step', 'final-grade', 'visible');
          finalEl.innerHTML = `Your Final Lecture Grade: ${prelimGrade.toFixed(1)}`;
          stepContainer.appendChild(finalEl);
          if (!Number.isInteger(prelimGrade)) {
            const roundUp = Math.ceil(prelimGrade);
            const roundDown = Math.floor(prelimGrade);
            const roundingEl = document.createElement('div');
            roundingEl.classList.add('step', 'rounded-info', 'visible');
            roundingEl.innerHTML = `Rounded Up Standard: ${roundUp}<br>Rounded Down Standard: ${roundDown}`;
            stepContainer.appendChild(roundingEl);
          }
          finalEl.appendChild(createStamp(prelimGrade));
          MathJax.typesetPromise([finalEl]);
        }
      }, 1500);
    }

    /***********************************************************
     *            LAB GRADE CALCULATOR
     ***********************************************************/
    function validateLab() {
      const fields = [
        { id: 'lab-java1', label: 'Java 1', min: 0, max: 100 },
        { id: 'lab-java2', label: 'Java 2', min: 0, max: 100 },
        { id: 'lab-js1', label: 'JS 1', min: 0, max: 100 },
        { id: 'lab-js2', label: 'JS 2', min: 0, max: 100 },
        { id: 'lab-mp1', label: 'MP1', min: 0, max: 100 },
        { id: 'lab-mp2', label: 'MP2', min: 0, max: 100 },
        { id: 'lab-mp3', label: 'MP3', min: 0, max: 100 },
        { id: 'lab-mp3d', label: 'mp3d', min: 0, max: 100 }
      ];
      let errors = [];
      fields.forEach(f => {
        const el = document.getElementById(f.id);
        const rawValue = el.value.trim();
        const val = parseFloat(rawValue);
        el.style.border = '';
        if (!rawValue) {
          errors.push(`${f.label} is empty.`);
          el.style.border = '2px solid red';
        } else if (isNaN(val)) {
          errors.push(`${f.label} is not a valid number.`);
          el.style.border = '2px solid red';
        } else if (val < f.min || val > f.max) {
          errors.push(`${f.label} should be between ${f.min} and ${f.max}.`);
          el.style.border = '2px solid red';
        }
      });
      return errors;
    }
    function setRandomValidLab() {
      document.getElementById('error-lab').innerHTML = '';
      setValue('lab-java1', getRandomInt(0, 100));
      setValue('lab-java2', getRandomInt(0, 100));
      setValue('lab-js1', getRandomInt(0, 100));
      setValue('lab-js2', getRandomInt(0, 100));
      setValue('lab-mp1', getRandomInt(0, 100));
      setValue('lab-mp2', getRandomInt(0, 100));
      setValue('lab-mp3', getRandomInt(0, 100));
      setValue('lab-mp3d', getRandomInt(0, 100));
      const labCheckboxes = [
        "lab-attendance-jan27",
        "lab-attendance-feb03",
        "lab-attendance-feb10",
        "lab-attendance-feb17"
      ];
      let absencesCount = getRandomInt(0, 3);
      let shuffledLab = labCheckboxes.sort(() => 0.5 - Math.random());
      shuffledLab.forEach((id, index) => {
        document.getElementById(id).checked = (index < absencesCount ? false : true);
      });
    }
    function calculateLabGrade() {
      // Clear any existing interval to avoid multiple outputs
      if (currentLabInterval !== null) {
        clearInterval(currentLabInterval);
        currentLabInterval = null;
      }
      document.getElementById('error-lab').innerHTML = '';
      const stepContainer = document.getElementById('steps-lab');
      stepContainer.style.display = 'none';
      stepContainer.innerHTML = '';
      
      const errors = validateLab();
      if (errors.length > 0) {
        let errHTML = '<ul>';
        errors.forEach(err => { errHTML += `<li>${err}</li>`; });
        errHTML += '</ul>';
        document.getElementById('error-lab').innerHTML = errHTML;
        return;
      }
      
      // Show notification and confetti
      showNotification();
      
      const java1 = parseFloat(document.getElementById('lab-java1').value);
      const java2 = parseFloat(document.getElementById('lab-java2').value);
      const js1 = parseFloat(document.getElementById('lab-js1').value);
      const js2 = parseFloat(document.getElementById('lab-js2').value);
      const mp1 = parseFloat(document.getElementById('lab-mp1').value);
      const mp2 = parseFloat(document.getElementById('lab-mp2').value);
      const mp3 = parseFloat(document.getElementById('lab-mp3').value);
      const mp3d = parseFloat(document.getElementById('lab-mp3d').value);
      const labAttendanceCheckboxes = [
        "lab-attendance-jan27",
        "lab-attendance-feb03",
        "lab-attendance-feb10",
        "lab-attendance-feb17"
      ];
      const absences = labAttendanceCheckboxes.reduce((acc, id) => {
        return acc + (document.getElementById(id).checked ? 0 : 1);
      }, 0);
      if (absences >= 4) {
        const failStamp = createStamp(0);
        document.getElementById('error-lab').innerHTML = '<ul><li>FAIL: Absences are 4 or more.</li></ul>';
        document.getElementById('error-lab').appendChild(failStamp);
        return;
      }
      const labExam = (java1 * 0.20) + (java2 * 0.30) + (js1 * 0.20) + (js2 * 0.30);
      const labWork = (mp1 + mp2 + mp3 + mp3d) / 4;
      const attendance = Math.max(100 - (absences * 10), 0);
      const labClassStanding = (labWork * 0.60) + (attendance * 0.40);
      const labGrade = (labExam * 0.60) + (labClassStanding * 0.40);
      const showSteps = document.getElementById('showStepsLab').checked;
      if (!showSteps) {
        let resultMsg = `Your Final Lab Grade: ${labGrade.toFixed(1)}`;
        if (!Number.isInteger(labGrade)) {
          const roundUp = Math.ceil(labGrade);
          const roundDown = Math.floor(labGrade);
          resultMsg += `<br>Rounded Up Standard: ${roundUp} | Rounded Down Standard: ${roundDown}`;
        }
        document.getElementById('error-lab').innerHTML = resultMsg;
        document.getElementById('error-lab').appendChild(createStamp(labGrade));
        return;
      }
      const steps = [
        `\\( \\text{Prelim Exam: } (${java1} \\times 0.20)Java 1 + (${java2} \\times 0.30)Java 2 + (${js1} \\times 0.20)JS 1 + (${js2} \\times 0.30)JS 2 = ${labExam.toFixed(2)} \\)`,
        `\\( \\text{Lab Work: } \\frac{${mp1} (MP1) + ${mp2} (MP2) + ${mp3} (MP3) + ${mp3d} (MP3 Doc)}{4} = ${labWork.toFixed(2)}\\% \\)`,
        `\\( \\text{Attendance: } 100 - (${absences} \\times 10) = ${attendance.toFixed(2)} \\)`,
        `\\( \\text{Class Standing: } (${labWork.toFixed(2)} \\times 0.60)LabWork + (${attendance.toFixed(2)} \\times 0.40)Attendace = ${labClassStanding.toFixed(2)} \\)`,
        `\\( \\text{Final Grade: } (${labExam.toFixed(2)} \\times 0.60)Exams + (${labClassStanding.toFixed(2)} \\times 0.40)ClassStanding = ${labGrade.toFixed(2)} \\)`
      ];
      stepContainer.style.display = 'block';
      let currentStep = 0;
      currentLabInterval = setInterval(() => {
        if (currentStep < steps.length) {
          const stepEl = document.createElement('div');
          stepEl.classList.add('step', 'visible');
          stepEl.innerHTML = steps[currentStep];
          stepContainer.appendChild(stepEl);
          MathJax.typesetPromise([stepEl]);
          currentStep++;
        } else {
          clearInterval(currentLabInterval);
          currentLabInterval = null;
          const finalEl = document.createElement('div');
          finalEl.classList.add('step', 'final-grade', 'visible');
          finalEl.innerHTML = `Your Final Lab Grade: ${labGrade.toFixed(1)}`;
          stepContainer.appendChild(finalEl);
          if (!Number.isInteger(labGrade)) {
            const roundUp = Math.ceil(labGrade);
            const roundDown = Math.floor(labGrade);
            const roundingEl = document.createElement('div');
            roundingEl.classList.add('step', 'rounded-info', 'visible');
            roundingEl.innerHTML = `Rounded Up Standard: ${roundUp}<br>Rounded Down Standard: ${roundDown}`;
            stepContainer.appendChild(roundingEl);
          }
          finalEl.appendChild(createStamp(labGrade));
          MathJax.typesetPromise([finalEl]);
        }
      }, 1500);
    }

    /***********************************************************
     *           PERFECT GRADE & RESET FUNCTIONS
     ***********************************************************/
    function perfectLectureGrade() {
      // Set perfect scores for lecture
      setPerfect('lec-exam', 100);
      setPerfect('lec-essay', 100);
      setPerfect('lec-pvm', 60);
      setPerfect('lec-java', 40);
      setPerfect('lec-js', 40);
      // Check all attendance checkboxes for lecture
      document.getElementById('lec-attendance-jan27').checked = true;
      document.getElementById('lec-attendance-feb03').checked = true;
      document.getElementById('lec-attendance-feb10').checked = true;
      document.getElementById('lec-attendance-feb17').checked = true;
      calculateLectureGrade();
    }
    function perfectLabGrade() {
      // Set perfect scores for lab
      setPerfect('lab-java1', 100);
      setPerfect('lab-java2', 100);
      setPerfect('lab-js1', 100);
      setPerfect('lab-js2', 100);
      setPerfect('lab-mp1', 100);
      setPerfect('lab-mp2', 100);
      setPerfect('lab-mp3', 100);
      setPerfect('lab-mp3d', 100);
      // Check all attendance checkboxes for lab
      document.getElementById('lab-attendance-jan27').checked = true;
      document.getElementById('lab-attendance-feb03').checked = true;
      document.getElementById('lab-attendance-feb10').checked = true;
      document.getElementById('lab-attendance-feb17').checked = true;
      calculateLabGrade();
    }
    function resetGrades() {
      // Reset lecture fields
      document.getElementById('lec-exam').value = '';
      document.getElementById('lec-essay').value = '';
      document.getElementById('lec-pvm').value = '';
      document.getElementById('lec-java').value = '';
      document.getElementById('lec-js').value = '';
      document.getElementById('lec-attendance-jan27').checked = true;
      document.getElementById('lec-attendance-feb03').checked = true;
      document.getElementById('lec-attendance-feb10').checked = true;
      document.getElementById('lec-attendance-feb17').checked = true;
      document.getElementById('error-lecture').innerHTML = '';
      document.getElementById('steps-lecture').innerHTML = '';
      document.getElementById('steps-lecture').style.display = 'none';

      // Reset lab fields
      document.getElementById('lab-java1').value = '';
      document.getElementById('lab-java2').value = '';
      document.getElementById('lab-js1').value = '';
      document.getElementById('lab-js2').value = '';
      document.getElementById('lab-mp1').value = '';
      document.getElementById('lab-mp2').value = '';
      document.getElementById('lab-mp3').value = '';
      document.getElementById('lab-mp3d').value = '';
      document.getElementById('lab-attendance-jan27').checked = true;
      document.getElementById('lab-attendance-feb03').checked = true;
      document.getElementById('lab-attendance-feb10').checked = true;
      document.getElementById('lab-attendance-feb17').checked = true;
      document.getElementById('error-lab').innerHTML = '';
      document.getElementById('steps-lab').innerHTML = '';
      document.getElementById('steps-lab').style.display = 'none';
    }

    /***********************************************************
     *                   INITIALIZE DOWNLOAD
     ***********************************************************/
    function downloadLectureCSV() {
      const exam = document.getElementById('lec-exam').value;
      const essay = document.getElementById('lec-essay').value;
      const pvm = document.getElementById('lec-pvm').value;
      const java = document.getElementById('lec-java').value;
      const js = document.getElementById('lec-js').value;
      const headers = ['exam', 'essay', 'pvm', 'java', 'js'];
      const row = [exam, essay, pvm, java, js];
      const csvContent = headers.join(",") + "\n" + row.join(",");
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "lecture-grade.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
    function downloadLabCSV() {
      const java1 = document.getElementById('lab-java1').value;
      const java2 = document.getElementById('lab-java2').value;
      const js1 = document.getElementById('lab-js1').value;
      const js2 = document.getElementById('lab-js2').value;
      const mp1 = document.getElementById('lab-mp1').value;
      const mp2 = document.getElementById('lab-mp2').value;
      const mp3 = document.getElementById('lab-mp3').value;
      const mp3d = document.getElementById('lab-mp3d').value;
      const headers = ['java1', 'java2', 'js1', 'js2', 'mp1', 'mp2', 'mp3', 'mp3d'];
      const row = [java1, java2, js1, js2, mp1, mp2, mp3, mp3d];
      const csvContent = headers.join(",") + "\n" + row.join(",");
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "lab-grade.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  </script>
  <div class="description-sidebar">
    <!-- Lecture Image -->
    <img src="lecture-formula.png" alt="Lecture Grade Formula" class="sidebar-image active" id="lecture-image">
    <!-- Lab Image -->
    <img src="lab-formula.png" alt="Lab Grade Formula" class="sidebar-image" id="lab-image">
    <div class="instructions" style="text-align: center;">
      <br>
      <h3 style="text-align: center;">Grade Formula</h3>
      <hr><br>
      <h3 style="text-align: center;">Instructions</h3>
      <p>üîÉSelect between Lecture or Lab calculator using tabs
        <br><br>
        ‚öñ Enter scores in all required fields
        <br><br>
        üåü Use Perfect Score buttons to fill max values
        <br><br>
        üé≤ Random button generates sample valid scores
        <br><br>
        üìÅ CSV upload accepts properly formatted grade files
        <br><br>
        ‚ûó Toggle step-by-step calculation as needed</p>
      <div id="lecture-desc"></div>
      <div id="lab-desc" style="display: none;"></div>
    </div>
  </div>
</body>
</html>
